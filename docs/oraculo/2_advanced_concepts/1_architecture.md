---
sidebar_position: 1
title: Architecture
---

# Advanced Concepts

## Architecture

### Roles

Components mapped by role

| Component         | Role                     | Description                                                                       |
|--------------------|--------------------------|-----------------------------------------------------------------------------------|
| OpenWebUI          | Interface                | Frontend for user interaction, sends the question directly to web api endpoint.   |
| FastAPI            | Backend/API              | Processing questions and response coordenation                                    |
| Airbyte            | ETL                      | Imports github external data and loads it in the database                         |
| Vanna.AI           | LLM / IA                 | Converts questions to SQL based on natural language                               |
| Gemini             | LLM / IA                 | Converts questions and given SQL query into the answer                            |
| Postgres/Chromadb  | Banco de Dados           | Stores collected data used by Gemini                                              |

---

### Components

The set of technologies that compose the app.

#### üê≥ Docker

Used to isolate different services, that of being:
- Database (Postgres)
- Backend (ETL + FastAPI)
- Frontend (OpenWeb UI)

On running ```bash docker compose up -d``` docker starts downloading and setting up the containers.
The docker compose executing sequence is as follows: 
    Database: Postgres setting and startup
    ‚Üì
    Backend: ETL process from start to finish, then, starts the web app listening.
    ‚Üì
    Frontend: Only stars after everything necessary (both services above). 

---

#### üîÑ Airbyte (ETL)

On backend startup, automatically starts the ETL process, using Airbyte. 

Extract: Via PyAirbyte, it access the github api, fetches de data and caches it.

Transform: Acess the cached data and stores it in local variables for the load process.

Load: Performs a sort of upsert, checking if a unique value exists in the table, if not, then executes insert into the database.

---

### üîå Fast API (Backend)

The API starts after the ETL process is concluded. 

Fast API is started via [uvicorn](https://www.uvicorn.org/) and starts listening on port: 8000.

Now the web server is ready to accept requests.

##### API Usage

Locally, you can access:

- **Fast API**: [http://localhost:8000](http://localhost:8000)

Once the app is running, you can send **POST** requests to `localhost:8000/ask`, with a **JSON** with a  "question" field in the JSON body. For example:

```json
{
  "question": "What was user x last commit?"
}
```

The app will send the input through Vanna, Gemini, then return the answer.

---

#### üß† Vanna.ai (LLM)

Converts natural language questions into accurate SQL queries for your database, after recognizing your schema and was recently trained with customized questions.

In the execution flow, its accessed right after receiving input from the user and before calling the Gemini API. 

The SQL generated by Vanna will be run and the query result will be sent to Gemini with the question. 

---

#### üß† Gemini (LLM)

The Gemini model will simply receive the input together with the query results and is asked to form a response with this given context and data. 

Its given output will be returned by the API, to the user interface.

---

#### üåê OpenWebUI (Interface)

Interface for user interaction, not complex at all.

Has to setup manually, inserting the function at startup. 

The function works as a pipeline, so the service knows what to do with your input. In this case, send to the backend through the endpoint.

---

##### OpenWebUI Usage

OpenWeb UI can be accessed:

- **OpenWebUI**: [http://localhost:3000](http://localhost:3000)

[Click here](./../../oraculo/2_basic_concepts/index.md/#how-to-use) to view the step-by-step setup.